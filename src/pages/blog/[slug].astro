---
import PostCategories from "@/components/blog/PostCategories.astro";
import PostMeta from "@/components/blog/PostMeta.astro";
import Layout from "@/layouts/Layout.astro";
import { PostSchema } from "@/types";
import { Picture } from "astro:assets";

    export const prerender = false
    const { slug } = Astro.params;
    const url = `${import.meta.env.API_URL}/posts?slug=${slug}`;
    const res = await fetch(url);
    const json = await res.json();
    const post = PostSchema.safeParse(json[0]);
    if(!post.success)return Astro.redirect('/404');

    const {title, feature_images,date, category_details, content} = post.data
---
<Layout 
    subtitle={title.rendered}
    bgImage={feature_images.full.url}
    title={title.rendered}>
    <article class="space-y-5 max-w-4xl mx-auto">
        <PostMeta date={date} />
        {category_details.map(cat => (
            <PostCategories name={cat.name} slug={cat.slug}/>
        ))}

        <Picture
            src={feature_images.full.url}
            alt={`Imagen del post ${title.rendered}`}
            width={feature_images.full.width}
            height={feature_images.full.height}
            formats={["avif", "webp"]}
            class="w-full"
        />
        <div class="text-lg space-y-3 mt-5" set:html={ content.rendered }></div>
    </article>
</Layout>